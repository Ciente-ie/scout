function renderActionListBySectorHTML(events, allPlayers) {
            if (!events || events.length === 0) {
                return '';
            }

            const actionLabels = {
                finalizacao: 'Finalização', finalizacao_adv: 'Finalização Adv.',
                chance_clara: 'Chance Clara', chance_clara_adv: 'Chance Adv.',
                duelo_ganho: 'Duelo Ganho', duelo_perdido: 'Duelo Perdido',
                falta_cometida: 'Falta Cometida', falta_sofrida: 'Falta Sofrida',
                cruzamento_dir: 'Cruzamento (Dir)', cruzamento_esq: 'Cruzamento (Esq)',
                passe_certo: 'Passe Certo', passe_errado: 'Passe Errado',
                gol: 'GOL', gol_contra: 'Gol Contra'
            };

            const actionsBySector = { defesa: [], meio: [], ataque: [] };
            
            events.forEach(e => {
                if (actionsBySector.hasOwnProperty(e.zone)) {
                    let actionKey = e.action;
                    if(e.action === 'falta') actionKey = e.detail;
                    if(e.action === 'cruzamento') actionKey = e.detail;
                    
                    const label = actionLabels[actionKey] || actionKey.replace(/_/g, ' ');
                    const player = allPlayers.find(p => p.id === e.playerId);
                    const playerName = player ? ` (${player.name})` : '';
                    const time = formatTime(e.time);
                    
                    actionsBySector[e.zone].push(`<li title="${time}">${label}${playerName}</li>`);
                }
            });

            return `
                <div class="mt-3 p-2 border-t border-gray-200 text-xs text-gray-600 report-section">
                    <h4 class="font-semibold text-center text-sm text-gray-800 mb-2">Lista de Ações por Setor</h4>
                    <div class="grid grid-cols-3 gap-3">
                        ${['defesa', 'meio', 'ataque'].map(sector => `
                            <div>
                                <h5 class="font-bold capitalize border-b border-gray-300 pb-1 mb-1">${sector}</h5>
                                <ul class="space-y-1 list-disc list-inside opacity-80">
                                    ${actionsBySector[sector].length > 0 ? actionsBySector[sector].join('') : '<li>Nenhuma ação</li>'}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderReportContentForPDF(match, specificPeriod = null) {
            const logoDataUrl = appState.settings.logoDataUrl;
            const logoImg = logoDataUrl ? `<img src="${logoDataUrl}" class="report-logo" crossorigin="anonymous" />` : '';
            const reportHeader = `<div class="report-header">${logoImg}<p class="text-right text-xs text-gray-500">Relatório de Análise de Desempenho</p></div>`;
            const reportFooter = `<div class="absolute bottom-0 left-1/2 -translate-x-1/2 text-center text-xs text-gray-400 p-2 w-full">Powered by Ciente - Inteligência Esportiva</div>`;
            if (specificPeriod) {
                const myTeamScore = match.events.filter(e => e.period == specificPeriod && e.action === 'gol').length;
                const opponentScore = match.events.filter(e => e.period == specificPeriod && e.action === 'gol_contra').length;
                const summaryTableHTML = getReportSummaryTableHTML(match, specificPeriod);
                const periodEvents = match.events.filter(e => e.period == specificPeriod);
                const actionListHTML = renderActionListBySectorHTML(periodEvents, appState.players);

                return `<div class="report-page">
                    ${reportHeader}
                    <div class="text-center mb-4"><h1 class="text-3xl font-bold">Relatório do ${specificPeriod}º Tempo</h1><p class="text-lg text-gray-600">${match.myTeamName} vs ${match.opponentName}</p></div>
                    <div class="text-center mb-6"><h2 class="text-2xl font-bold">Placar do Período: ${myTeamScore} x ${opponentScore}</h2></div>
                     <div class="space-y-8 report-section">
                        <div class="bg-gray-50 p-3 rounded-lg border"><h3 class="text-xl font-bold text-center mb-2">Posse de Bola (1ºT)</h3><div class="chart-container h-20"><canvas id="possessionChart_${specificPeriod}T"></canvas></div></div>
                        <div class="bg-gray-50 p-3 rounded-lg border"><h3 class="text-xl font-bold text-center mb-2">Resumo de Ações</h3>${summaryTableHTML}</div>
                    </div>
                    ${reportFooter}
                </div>`;
            }
            
            const page1 = `<div class="report-page">
                ${reportHeader}
                <div class="text-center mb-6"><h1 class="text-4xl font-bold">${match.myTeamName} ${match.myTeamScore} x ${match.opponentScore} ${match.opponentName}</h1><p class="text-lg text-gray-600">${new Date(match.date).toLocaleDateString('pt-BR', {timeZone: 'UTC'})} - ${match.location}</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 report-section">
                     <div class="bg-gray-50 p-3 rounded-lg border"><h3 class="text-xl font-bold text-center mb-2">Posse de Bola (Total)</h3><div class="chart-container h-20"><canvas id="possessionChart"></canvas></div><p class="text-center text-sm text-gray-600 mt-2">Tempo Total: ${formatTime(match.timerSeconds || 0)}</p></div>
                    <div class="bg-gray-50 p-3 rounded-lg border"><h3 class="text-xl font-bold text-center mb-2">Destaque da Partida</h3><div id="report-motm"></div></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 report-section">
                    <div class="bg-gray-50 p-3 rounded-lg border">
                        <h3 class="text-xl font-bold text-center mb-4">Volume de Ações (Total)</h3>
                        <div class="chart-container" style="background-color: #166534; min-height: 240px; height: 240px;"><canvas id="actionMapChart"></canvas></div>
                        <div class="flex justify-between items-center mt-2 px-4"><span class="font-semibold text-gray-700">Defesa</span><svg class="w-full h-8 text-gray-500" viewBox="0 0 100 10" preserveAspectRatio="none"><path d="M0,5 h100 l-10,-4 m10,4 l-10,4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" /></svg><span class="font-semibold text-gray-700">Ataque</span></div>
                        ${renderActionListBySectorHTML(match.events, appState.players)}
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border"><h3 class="text-xl font-bold text-center mb-2">Destaques Individuais</h3><div id="report-top-stats"></div></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 report-section">
                    <div class="bg-gray-50 p-3 rounded-lg border"><h3 class="text-xl font-bold text-center mb-2">Resumo de Ações (Total)</h3><div id="report-summary-table"></div></div>
                    <div class="bg-gray-50 p-3 rounded-lg border"><div id="report-formation"></div></div>
                </div>
                ${reportFooter}
            </div>`;

            const page2 = `<div class="report-page">
                ${reportHeader}
                <div class="text-center mb-8 pt-8"><h1 class="text-3xl font-bold">Scout por Período</h1></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 report-section">
                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-center mb-4">1º Tempo</h3>
                        <div class="bg-gray-50 p-4 rounded-lg border">
                             <h4 class="font-semibold text-center mb-2">Posse de Bola (1ºT)</h4>
                             <div class="chart-container h-20"><canvas id="possessionChart_1T_report"></canvas></div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg border">
                            <h4 class="font-semibold text-center mb-2">Volume de Ações (1ºT)</h4>
                            <div class="chart-container" style="background-color: #166534; min-height: 240px;"><canvas id="actionMapChart_1T"></canvas></div>
                            <div class="flex justify-between items-center mt-2 px-4"><span class="font-semibold text-gray-700">Defesa</span><svg class="w-full h-8 text-gray-500" viewBox="0 0 100 10" preserveAspectRatio="none"><path d="M0,5 h100 l-10,-4 m10,4 l-10,4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" /></svg><span class="font-semibold text-gray-700">Ataque</span></div>
                            ${renderActionListBySectorHTML(match.events.filter(e => e.period == 1), appState.players)}
                        </div>
                        <div id="report-summary-table-1T" class="mt-4"></div>
                    </div>
                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-center mb-4">2º Tempo</h3>
                         <div class="bg-gray-50 p-4 rounded-lg border">
                             <h4 class="font-semibold text-center mb-2">Posse de Bola (2ºT)</h4>
                             <div class="chart-container h-20"><canvas id="possessionChart_2T_report"></canvas></div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg border">
                            <h4 class="font-semibold text-center mb-2">Volume de Ações (2ºT)</h4>
                            <div class="chart-container" style="background-color: #166534; min-height: 240px;"><canvas id="actionMapChart_2T"></canvas></div>
                            <div class="flex justify-between items-center mt-2 px-4"><span class="font-semibold text-gray-700">Defesa</span><svg class="w-full h-8 text-gray-500" viewBox="0 0 100 10" preserveAspectRatio="none"><path d="M0,5 h100 l-10,-4 m10,4 l-10,4" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" /></svg><span class="font-semibold text-gray-700">Ataque</span></div>
                            ${renderActionListBySectorHTML(match.events.filter(e => e.period == 2), appState.players)}
                        </div>
                        <div id="report-summary-table-2T" class="mt-4"></div>
                    </div>
                </div>
                ${reportFooter}
            </div>`;
            
            return page1 + page2;
        }
